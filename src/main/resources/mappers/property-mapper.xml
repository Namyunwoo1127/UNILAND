<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.elon.boot.domain.property.model.store.PropertyMapper">

  <select id="selectOneByNo" resultType="com.elon.boot.domain.property.model.vo.Property">
    SELECT *
    FROM PROPERTY_TBL
    WHERE PROPERTY_NO = #{id, jdbcType=NUMERIC}
  </select>

  <select id="selectOnesOption" resultType="com.elon.boot.domain.property.model.vo.PropertyOption">
    SELECT *
    FROM OPTION_TBL
    WHERE PROPERTY_NO = #{id, jdbcType=NUMERIC}
  </select>

  <select id="selectOnesImg" resultType="com.elon.boot.domain.property.model.vo.PropertyImg">
    SELECT *
    FROM (
        SELECT *
        FROM PROPERTIES_IMG_TBL
        WHERE PROPERTY_NO = #{id, jdbcType=NUMERIC}
        ORDER BY IMG_ORDER ASC
    )
    WHERE ROWNUM = 1
  </select>
<!-- <insert id="insertProperty" parameterType="com.elon.boot.domain.property.model.vo.Property">
  <selectKey keyProperty="propertyNo" order="BEFORE" resultType="long">
    SELECT SEQ_PROPERTY_NO.NEXTVAL FROM DUAL
  </selectKey>
  INSERT INTO PROPERTY_TBL (
    PROPERTY_NO, REALTOR_ID,
    PROPERTY_NAME, PROPERTY_TYPE,
    ROOM, BATHROOM, FLOOR, TOTAL_FLOOR,
    CONSTRUCTION_YEAR, AVAILABLE_DATE, STUDENT_PREF, SHORT_CONT,
    PRICE_TYPE, DEPOSIT, MONTHLY_RENT, MAINTENANCE_FEE, MAINTENANCE_INCL,
    ROAD_ADDRESS, ADDRESS_DETAIL, PROVINCE, DISTRICT, LATITUDE, LONGITUDE,
    CONTRACT_AREA, DESCRIPTION, STATUS, CREATED_AT
  ) VALUES (
    #{propertyNo}, #{realtorId},
    #{propertyName}, #{propertyType},
    #{room}, #{bathroom}, #{floor}, #{totalFloor},
    #{constructionYear}, #{availableDate}, #{studentPref}, #{shortCont},
    #{priceType}, #{deposit}, #{monthlyRent}, #{maintenanceFee}, #{maintenanceIncl},
    #{roadAddress}, #{addressDetail}, #{province}, #{district}, #{latitude}, #{longitude},
    #{contractArea}, #{description}, 'ACTIVE', SYSTIMESTAMP
  )
</insert> -->
<!-- 이미지 삽입 -->
<!-- <insert id="insertPropertyImages">
  INSERT INTO PROPERTIES_IMG_TBL 
  SELECT SEQ_PROPERTIES_IMG_NO.NEXTVAL , BI.*
  FROM (
  	<foreach collection="list" item="img" separator=" UNION ALL ">
  	SELECT 	#{img.propertyNo} 		PROPERTY_NO,
  			#{img.imgPath}			IMG_PATH,
  			#{img.imgRename}		IMG_RENAME,
  			#{img.imgOriginalName}	IMG_ORIGINAL_NAME,
  			#{img.imgOrder}			IMG_ORDER
		FROM DUAL
  </foreach>
  )BI
</insert> -->
  <insert id="insertProperty" parameterType="com.elon.boot.domain.property.model.vo.Property">
    <selectKey keyProperty="propertyNo" order="BEFORE" resultType="long">
      SELECT SEQ_PROPERTY_NO.NEXTVAL FROM DUAL
    </selectKey>

    INSERT INTO PROPERTY_TBL (
      PROPERTY_NO, REALTOR_ID,
      PROPERTY_NAME, PROPERTY_TYPE,
      ROOM, BATHROOM, FLOOR, TOTAL_FLOOR,
      CONSTRUCTION_YEAR, AVAILABLE_DATE,
      STUDENT_PREF, SHORT_CONT,
      PRICE_TYPE, DEPOSIT, MONTHLY_RENT,
      MAINTENANCE_FEE, MAINTENANCE_INCL,
      ROAD_ADDRESS, PARCEL_ADDRESS, ADDRESS_DETAIL,
      PROVINCE, DISTRICT,
      LATITUDE, LONGITUDE,
      CONTRACT_AREA, DESCRIPTION,
      STATUS, CREATED_AT
    ) VALUES (
      #{propertyNo,       jdbcType=NUMERIC},
      #{realtorId,        jdbcType=VARCHAR},

      #{propertyName,     jdbcType=VARCHAR},
      #{propertyType,     jdbcType=VARCHAR},

      #{room,             jdbcType=NUMERIC},
      #{bathroom,         jdbcType=NUMERIC},
      #{floor,            jdbcType=NUMERIC},
      #{totalFloor,       jdbcType=NUMERIC},

      #{constructionYear, jdbcType=VARCHAR},
      #{availableDate,    jdbcType=VARCHAR},

      #{studentPref,      jdbcType=VARCHAR},   <!-- VARCHAR2(1) -->
      #{shortCont,        jdbcType=VARCHAR},   <!-- VARCHAR2(1) -->

      #{priceType,        jdbcType=VARCHAR},
      #{deposit,          jdbcType=NUMERIC},
      #{monthlyRent,      jdbcType=NUMERIC},

      #{maintenanceFee,   jdbcType=NUMERIC},
      #{maintenanceIncl,  jdbcType=VARCHAR},   <!-- VARCHAR2(1) -->

      #{roadAddress,      jdbcType=VARCHAR},
      #{parcelAddress,    jdbcType=VARCHAR},   <!-- 추가 -->
      #{addressDetail,    jdbcType=VARCHAR},

      #{province,         jdbcType=VARCHAR},
      #{district,         jdbcType=VARCHAR},

      #{latitude,         jdbcType=NUMERIC},
      #{longitude,        jdbcType=NUMERIC},

      #{contractArea,     jdbcType=NUMERIC},
      #{description,      jdbcType=CLOB},      <!-- CLOB -->

      'ACTIVE',
      SYSTIMESTAMP
    )
  </insert>

  <!-- 이미지 일괄 INSERT -->
  <insert id="insertPropertyImages">
    INSERT INTO PROPERTIES_IMG_TBL
    SELECT SEQ_PROPERTIES_IMG_NO.NEXTVAL, BI.*
    FROM (
      <foreach collection="list" item="img" separator=" UNION ALL ">
        SELECT
          #{img.propertyNo,     jdbcType=NUMERIC}  AS PROPERTY_NO,
          #{img.imgPath,        jdbcType=VARCHAR}  AS IMG_PATH,
          #{img.imgRename,      jdbcType=VARCHAR}  AS IMG_RENAME,
          #{img.imgOriginalName,jdbcType=VARCHAR}  AS IMG_ORIGINAL_NAME,
          #{img.imgOrder,       jdbcType=NUMERIC}  AS IMG_ORDER
        FROM DUAL
      </foreach>
    ) BI
  </insert>

</mapper>