<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.elon.boot.domain.realtor.model.store.RealtorMapper">

    <!-- ✅ 사업자등록번호 중복 확인 -->
    <select id="countByBusinessNum" resultType="int">
	    SELECT COUNT(*)
	    FROM REALTOR_TBL
	    WHERE BUSINESS_NUM = #{businessNum, jdbcType=VARCHAR}
	</select>


    <!-- ✅ 회원 등록 -->
    <insert id="insertRealtor" parameterType="com.elon.boot.domain.realtor.model.vo.Realtor">
        INSERT INTO REALTOR_TBL (
	        REALTOR_ID,
	        REALTOR_PASSWORD,
	        OFFICE_NAME,
	        REALTOR_NAME,
	        REALTOR_ADDRESS,
	        REALTOR_PHONE,
	        REALTOR_EMAIL,
	        BUSINESS_NUM,
	        CREATED_AT,
	        STATUS,
	        APPROVAL_STATUS
	    ) VALUES (
	        #{realtorId, jdbcType=VARCHAR},
	        #{realtorPassword, jdbcType=VARCHAR},
	        #{officeName, jdbcType=VARCHAR},
	        #{realtorName, jdbcType=VARCHAR},
	        #{realtorAddress, jdbcType=VARCHAR},
	        #{realtorPhone, jdbcType=VARCHAR},
	        #{realtorEmail, jdbcType=VARCHAR},
	        #{businessNum, jdbcType=VARCHAR},
	        CURRENT_TIMESTAMP,
	        'ACTIVE',
	        'PENDING'
	    )
    </insert>

    <!-- ✅ 로그인 정보로 중개사 조회 -->
    <select id="findByLoginInfo" resultType="com.elon.boot.domain.realtor.model.vo.Realtor">
        SELECT *
        FROM REALTOR_TBL
        WHERE REALTOR_ID = #{realtorId}
          AND REALTOR_PASSWORD = #{password}
          AND BUSINESS_NUM = #{businessNumber}
          AND STATUS = 'ACTIVE'
    </select>

</mapper>
